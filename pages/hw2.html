<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='cache-control' content='no-cache'> 
    <meta http-equiv='expires' content='0'> 
    <meta http-equiv='pragma' content='no-cache'>
    <title>Homework 2</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../prism.css"> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- For this HW we are going to need AJAX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>

    <h1>Homework 2</h1>
    <h2>Author: Pietro Colaguori 1936709</h2>
    <a href="../index.html">Home</a>
    <hr>
    <p>The request is as follows:</p><br>
    <pre class="question">Choose 3 variables from our surveys:
        - one Qualitative
        - one Quantitative discrete
        - one Quantitative continuous (use class intervals in this case, obviously)
        
        create the most efficient algorithms to compute the frequency (absolute/relative/percentage) distribution of:
        
        - the 3 variables
        - the joint distribution of 2 variables (use a general logic, where variables could be any number).
        
        Double check/compare the results using some DBMS functionalities you prefer (eg., access, oracle online, postgres, ...)</pre>

    <h3 class="red">Professional Life Survey - Analysis</h3>
    <!-- Qualitative: expected work sector, Quantitative: expected salary, Quantitative Continuous: height-->
    <p> Upload the XLSX file of the Professional Life survey</p>
    <input type="file" id="fileInput" accept=".xlsx">
    <button id="upload" onclick="return analyze()">Upload</button>
    <div id="output"></div>
    
    <div id="results">
        <!-- Frequency distributions will be displayed here -->
    </div>

    <div id="jointResults">
        <!-- Joint probability distribution will be displayed here -->  
    </div>

    <script>
        function analyze() {
            // Access contents of XLSX file
            var file = document.getElementById("fileInput").files[0];
            var reader = new FileReader();
            reader.onload = function(e) {
                var data = e.target.result;
                var workbook = XLSX.read(data, {type: 'binary'});
                var sheet_name_list = workbook.SheetNames;
                var xlData = XLSX.utils.sheet_to_json(workbook.Sheets[sheet_name_list[0]], {blankrows: false});
                
                // Access the values of the column "expected work sectors"
                var workSectors = [];
                for (var i = 0; i < xlData.length; i++) {
                    if (xlData[i]["Expected work sectors"] !== undefined) {
                        workSectors.push(xlData[i]["Expected work sectors"]);
                    }
                }
        
                // Access the values of the column "expected salary"
                var expectedSalary = [];
                for (var i = 0; i < xlData.length; i++) {
                    if (xlData[i]["Expected net remuneration (monthly)"] !== undefined) {
                        expectedSalary.push(xlData[i]["Expected net remuneration (monthly)"]);
                    }
                }
        
                // Access the values of the column "height"
                var height = [];
                for (var i = 0; i < xlData.length; i++) {
                    if (xlData[i]["height"] !== undefined) {
                        height.push(xlData[i]["height"]);
                    }
                }
        
                // Compute the frequency distribution of the 3 variables
                var workSectorsFreq = {};
                for (var i = 0; i < workSectors.length; i++) {
                    if (workSectorsFreq[workSectors[i]] == undefined) {
                        workSectorsFreq[workSectors[i]] = 1;
                    } else {
                        workSectorsFreq[workSectors[i]]++;
                    }
                }
        
                var expectedSalaryFreq = {};
                for (var i = 0; i < expectedSalary.length; i++) {
                    if (expectedSalaryFreq[expectedSalary[i]] == undefined) {
                        expectedSalaryFreq[expectedSalary[i]] = 1;
                    } else {
                        expectedSalaryFreq[expectedSalary[i]]++;
                    }
                }
        
                var heightFreq = {};
                for (var i = 0; i < height.length; i++) {
                    if (heightFreq[height[i]] == undefined) {
                        heightFreq[height[i]] = 1;
                    } else {
                        heightFreq[height[i]]++;
                    }
                }
        
                // Compute the relative and percentage frequencies of the 3 variables
                var workSectorsRelFreq = {};
                var workSectorsPercFreq = {};
                for (var sector in workSectorsFreq) {
                    workSectorsRelFreq[sector] = workSectorsFreq[sector] / workSectors.length;
                    workSectorsPercFreq[sector] = workSectorsRelFreq[sector] * 100;
                }
        
                var expectedSalaryRelFreq = {};
                var expectedSalaryPercFreq = {};
                for (var salary in expectedSalaryFreq) {
                    expectedSalaryRelFreq[salary] = expectedSalaryFreq[salary] / expectedSalary.length;
                    expectedSalaryPercFreq[salary] = expectedSalaryRelFreq[salary] * 100;
                }
        
                var heightRelFreq = {};
                var heightPercFreq = {};
                for (var h in heightFreq) {
                    heightRelFreq[h] = heightFreq[h] / height.length;
                    heightPercFreq[h] = heightRelFreq[h] * 100;
                }
        
                // Display the frequency distributions on the page
                displayResults(workSectorsFreq, workSectorsRelFreq, workSectorsPercFreq, expectedSalaryFreq, expectedSalaryRelFreq, expectedSalaryPercFreq, heightFreq, heightRelFreq, heightPercFreq);
            
                // Access the values of the column "Team leader or Team player ?"
                var teamLeaderOrPlayer = [];
                for (var i = 0; i < xlData.length; i++) {
                    if (xlData[i]["Team leader or Team player ?"] !== undefined) {
                        teamLeaderOrPlayer.push(xlData[i]["Team leader or Team player ?"].toLowerCase());
                    }
                }

                // Access the values of the column "Sex"
                var sex = [];
                for (var i = 0; i < xlData.length; i++) {
                    if (xlData[i]["Sex"] !== undefined) {
                        sex.push(xlData[i]["Sex"].toLowerCase());
                    }
                }

                // Compute joint probability distribution between sex and teamLeaderOrPlayer
                var jointProb = {};
                for (var i = 0; i < sex.length; i++) {
                    if (jointProb[sex[i]] == undefined) {
                        jointProb[sex[i]] = {};
                    }
                    if (jointProb[sex[i]][teamLeaderOrPlayer[i]] == undefined) {
                        jointProb[sex[i]][teamLeaderOrPlayer[i]] = 1;
                    } else {
                        jointProb[sex[i]][teamLeaderOrPlayer[i]]++;
                    }
                }

                for (var sexVal in jointProb) {
                    for (var teamVal in jointProb[sexVal]) {
                        jointProb[sexVal][teamVal] /= sex.length;
                        jointProb[sexVal][teamVal] *= 100;
                    }
                }

                displayJointProbability(jointProb);

            };
            reader.readAsBinaryString(file);
        }
        
        function displayResults(workSectorsFreq, workSectorsRelFreq, workSectorsPercFreq, expectedSalaryFreq, expectedSalaryRelFreq, expectedSalaryPercFreq, heightFreq, heightRelFreq, heightPercFreq) {
            var resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "<h3>Frequency Distributions:</h3>";
            
            // Display the frequency distribution for the "Expected work sectors" variable
            resultsDiv.innerHTML += "<h4>Expected Work Sectors:</h4>";
            for (var sector in workSectorsFreq) {
                resultsDiv.innerHTML += sector + ": " + workSectorsFreq[sector] + " (" + workSectorsRelFreq[sector].toFixed(2) + " or " + workSectorsPercFreq[sector].toFixed(2) + "%)" + "<br>";
            }
        
            // Display the frequency distribution for the "Expected salary" variable
            resultsDiv.innerHTML += "<h4>Expected Salary:</h4>";
            for (var salary in expectedSalaryFreq) {
                resultsDiv.innerHTML += salary + ": " + expectedSalaryFreq[salary] + " (" + expectedSalaryRelFreq[salary].toFixed(2) + " or " + expectedSalaryPercFreq[salary].toFixed(2) + "%)" + "<br>";
            }
        
            // Display the frequency distribution for the "Height" variable
            resultsDiv.innerHTML += "<h4>Height:</h4>";
            for (var h in heightFreq) {
                resultsDiv.innerHTML += h + ": " + heightFreq[h] + " (" + heightRelFreq[h].toFixed(2) + " or " + heightPercFreq[h].toFixed(2) + "%)" + "<br>";
            }
        }

        function displayJointProbability(jointProb) {
            var resultsDiv = document.getElementById("jointResults");
            resultsDiv.innerHTML += "<h4>Joint Probability Distribution:</h4>";
            for (var sexVal in jointProb) {
                for (var teamVal in jointProb[sexVal]) {
                    resultsDiv.innerHTML += sexVal + " and " + teamVal + ": " + jointProb[sexVal][teamVal].toFixed(2) + "%<br>";
                }
            }
        }

    </script>

    <h3 class="red">After Life Survey - Analysis</h3>
    <!-- Qualitative: religion, Quantitative: ???, Quantitative Continuous: ???-->
    <p> Upload the XLSX file of the After Life survey</p>
    <input type="file" id="fileInput2" accept=".xlsx">
    <button id="upload2" onclick="return analyze2()">Upload</button>
    <div id="output2"></div>
    
    <div id="results2">
        <!-- Frequency distributions will be displayed here -->
    </div>

    <div id="jointResults2">
        <!-- Joint probability distribution will be displayed here -->
    </div>

    <script>
        function analyze2() {
            // Access contents of XLSX file
            var file = document.getElementById("fileInput2").files[0];
            var reader = new FileReader();
            reader.onload = function(e) {
            var data = e.target.result;
            var workbook = XLSX.read(data, {type: 'binary'});
            var sheet_name_list = workbook.SheetNames;
            var xlData = XLSX.utils.sheet_to_json(workbook.Sheets[sheet_name_list[0]], {blankrows: false});
                
            // Access the values of the column "Religious yes/no"
            var answers = [];
            for (var i = 0; i < xlData.length; i++) {
                if (xlData[i]["Religious yes/no"] !== undefined) {
                    answers.push(xlData[i]["Religious yes/no"].toLowerCase());
                }
            }

                // Compute the frequency distributon of the variable
                var answersFreq = {};
                for (var i = 0; i < answers.length; i++) {
                    if (answersFreq[answers[i]] == undefined) {
                        answersFreq[answers[i]] = 1;
                    } else {
                        answersFreq[answers[i]]++;
                    }
                }

                // Compute the relative and percentage frequencies of the variable
                var answersRelFreq = {};
                var answersPercFreq = {};
                for (var answer in answersFreq) {
                    answersRelFreq[answer] = answersFreq[answer] / answers.length;
                    answersPercFreq[answer] = answersRelFreq[answer] * 100;
                }

                // Display the frequency distributions on the page
                displayResults2(answersFreq, answersRelFreq, answersPercFreq);

                // Access the values of the column "Reincarnation in anything yes/no"
                var reincarnation = [];
                for (var i = 0; i < xlData.length; i++) {
                    if (xlData[i]["Reincarnation in anything yes/no"] !== undefined) {
                        reincarnation.push(xlData[i]["Reincarnation in anything yes/no"].toLowerCase());
                    }
                }

                // Compute the joint probability distribution between answers and reincarnation
                var jointProb = {};
                for (var i = 0; i < answers.length; i++) {
                    if (jointProb[answers[i]] == undefined) {
                        jointProb[answers[i]] = {};
                    }
                    if (jointProb[answers[i]][reincarnation[i]] == undefined) {
                        jointProb[answers[i]][reincarnation[i]] = 1;
                    } else {
                        jointProb[answers[i]][reincarnation[i]]++;
                    }
                }

                for (var answer in jointProb) {
                    for (var reinc in jointProb[answer]) {
                        jointProb[answer][reinc] /= answers.length;
                        jointProb[answer][reinc] *= 100;
                    }
                }

                displayJointProbability2(jointProb);
            };
            reader.readAsBinaryString(file);  
        }

        function displayResults2(answersFreq, answersRelFreq, answersPercFreq) {
            var resultsDiv = document.getElementById("results2");
            resultsDiv.innerHTML = "<h3>Frequency Distributions:</h3>";
            
            // Display the frequency distribution for the "Religious yes/no" variable
            resultsDiv.innerHTML += "<h4>Religious yes/no:</h4>";
            for (var answer in answersFreq) {
                resultsDiv.innerHTML += answer + ": " + answersFreq[answer] + " (" + answersRelFreq[answer].toFixed(2) + " or " + answersPercFreq[answer].toFixed(2) + "%)" + "<br>";
            }
        }

        function displayJointProbability2(jointProb) {
            var resultsDiv = document.getElementById("jointResults2");
            resultsDiv.innerHTML += "<h4>Joint Probability Distribution (Religious? and Believes in Reincarnation?):</h4>";
            for (var answer in jointProb) {
                for (var reinc in jointProb[answer]) {
                    resultsDiv.innerHTML += answer + " and " + reinc + ": " + jointProb[answer][reinc].toFixed(2) + "%<br>";
                }
            }
        }
    </script>

    <h3 class="red">Comparison with Famous DBMS functionalities</h3>

    <br><hr><br>

    <pre class="question">
        For the following most important data structures (or others that you may want to suggest) find out how to:

-loop (break/continue)
-add/remove/get/set/check the existence of key/value

data structures:
array, list, dictionary, sorted list, hashset, sortedset, queue, stack, linkedlist (or any other structure you think to be useful)

Note in a very concise way your finding in your Js Cheatsheet, and, in case a corresponding Js object does not exists, create a simple equivalent class with all necessary corresponding methods.
    </pre>

    The CheatSheet file I have created, with all the useful snippets, can be found at the following link: <a href="./cheatsheet.html">JS Cheatsheet</a>

    <br><hr><br>

    <pre class="question">
        Generate N uniform random variates in [0,1) and determine the distribution into class intervals [i/k, (i+1)/k), i = 0,..., k-1.
Play with N and k values and draw some conclusion on the "shape" of the distribution.
    </pre>

    <input type="number" id="N" placeholder="N">
    <input type="number" id="k" placeholder="k">
    <button id="generate" onclick="return generate()">Generate</button>
    <div id="output3"></div>

    <script>
            function generate() {
                var N = document.getElementById("N").value;
                var k = document.getElementById("k").value;
                var output = document.getElementById("output3");
                output.innerHTML = "";
                var randoms = [];
                for (var i = 0; i < N; i++) {
                    randoms.push(Math.random());
                }
                var classIntervals = [];
                for (var i = 0; i < k; i++) {
                    classIntervals.push([i/k, (i+1)/k]);
                }
                var classFreq = {};
                for (var i = 0; i < classIntervals.length; i++) {
                    classFreq[i] = 0;
                }
                for (var i = 0; i < randoms.length; i++) {
                    for (var j = 0; j < classIntervals.length; j++) {
                        if (randoms[i] >= classIntervals[j][0] && randoms[i] < classIntervals[j][1]) {
                            classFreq[j]++;
                        }
                    }
                }
                for (var i = 0; i < classIntervals.length; i++) {
                    output.innerHTML += "[" + classIntervals[i][0] + ", " + classIntervals[i][1] + "): " + classFreq[i] + "<br>";
                }
                
                 // Generate N random variates in [0, 1)
                const randomVariates = Array.from({ length: N }, () => Math.random());

        // Calculate the histogram
        const binEdges = Array.from({ length: k + 1 }, (_, i) => (i / k));
        const histogram = Array.from({ length: k }, (_, i) => {
            const lowerBound = binEdges[i];
            const upperBound = binEdges[i + 1];
            return randomVariates.filter(value => value >= lowerBound && value < upperBound).length / N;
        });

        // Display the histogram using Chart.js
        const ctx = document.getElementById('histogram').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: binEdges.slice(0, k),
                datasets: [{
                    label: 'Frequency',
                    data: histogram,
                    backgroundColor: 'rgba(75, 192, 192, 0.5)'
                }]
            },
            options: {
                scales: {
                    x: {
                        beginAtZero: true
                    },
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        }
        </script>
        <canvas id="histogram"></canvas>

    <br><hr><br>

    <script src="../prism.js"></script>
</body>
</html>
