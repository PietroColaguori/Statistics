<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='cache-control' content='no-cache'> 
    <meta http-equiv='expires' content='0'> 
    <meta http-equiv='pragma' content='no-cache'>
    <title>Homework 2</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../prism.css"> 
</head>
<body>
    <!-- For this HW we are going to need AJAX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>

    <h1>Homework 2</h1>
    <h2>Author: Pietro Colaguori 1936709</h2>
    <a href="../index.html">Home</a>
    <hr>
    <p>The request is as follows:</p><br>
    <pre class="question">Choose 3 variables from our surveys:
        - one Qualitative
        - one Quantitative discrete
        - one Quantitative continuous (use class intervals in this case, obviously)
        
        create the most efficient algorithms to compute the frequency (absolute/relative/percentage) distribution of:
        
        - the 3 variables
        - the joint distribution of 2 variables (use a general logic, where variables could be any number).
        
        Double check/compare the results using some DBMS functionalities you prefer (eg., access, oracle online, postgres, ...)</pre>

    <h3 class="red">Professional Life Survey - Analysis</h3>
    <!-- Qualitative: expected work sector, Quantitative: expected salary, Quantitative Continuous: height-->
    <p> Upload the first XLSX file </p>
    <input type="file" id="fileInput" accept=".xlsx">
    <button id="upload" onclick="return analyze()">Upload</button>
    
    <p> Upload the second XLSX file </p>
    <input type="file" id="fileInput2" accept=".xlsx">
    <button id="upload2" onclick="return analyze2()">Upload</button>
    
    <div id="output"></div>
    
    <div id="results">
        <!-- Frequency distributions will be displayed here for the first XLSX file -->
    </div>

    <div id="results2">
        <!-- Frequency distributions will be displayed here for the second XLSX file -->
    </div>

    <script type="text/javascript">
        function processExcel(fileInputId, resultsDivId, columnName) {
            var fileInput = document.getElementById(fileInputId);
            var file = fileInput.files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var data = e.target.result;
                var workbook = XLSX.read(data, { type: 'binary' });
                var sheetName = workbook.SheetNames[0];
                var xlData = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);

                // Extract the specified column from the Excel file
                var columnData = [];
                for (var i = 0; i < xlData.length; i++) {
                    var cellValue = xlData[i][columnName];

                    // Check if the value is not empty and skip the row if it is
                    if (cellValue !== undefined) {
                        columnData.push(cellValue);
                    }
                }

                // Compute the frequency distribution of the specified column
                var columnFreq = {};
                for (var i = 0; i < columnData.length; i++) {
                    if (columnFreq[columnData[i]] == undefined) {
                        columnFreq[columnData[i]] = 1;
                    } else {
                        columnFreq[columnData[i]]++;
                    }
                }

                // Compute the relative frequency distribution of the specified column
                var columnRelFreq = {};
                for (var value in columnFreq) {
                    columnRelFreq[value] = columnFreq[value] / columnData.length;
                }

                // Compute the percentage frequency distribution of the specified column
                var columnPercFreq = {};
                for (var value in columnFreq) {
                    columnPercFreq[value] = columnRelFreq[value] * 100;
                }

                // Display the frequency distributions on the page
                displayResults(resultsDivId, columnFreq, columnRelFreq, columnPercFreq);
            };
            reader.readAsBinaryString(file);
        }

        function analyze() {
            processExcel("fileInput", "results", "Expected work sectors");
        }

        function analyze2() {
            processExcel("fileInput2", "results2", "Religious yes/no");
        }
        
        function displayResults(resultsDivId, columnFreq, columnRelFreq, columnPercFreq) {
            var resultsDiv = document.getElementById(resultsDivId);
            resultsDiv.innerHTML = "<h3>Frequency Distributions:</h3>";
            
            resultsDiv.innerHTML += "<h4>Column:</h4>";
            resultsDiv.innerHTML += "<table>";
            resultsDiv.innerHTML += "<tr><th>Value</th><th>Frequency</th><th>Relative Frequency</th><th>Percentage Frequency</th></tr>";
            for (var value in columnFreq) {
                resultsDiv.innerHTML += "<tr><td>" + value + "</td><td>" + columnFreq[value] + "</td><td>" + columnRelFreq[value].toFixed(2) + "</td><td>" + columnPercFreq[value].toFixed(2) + "%</td></tr>";
            }
            resultsDiv.innerHTML += "</table>";
        }
    </script>
</body>
</html>
