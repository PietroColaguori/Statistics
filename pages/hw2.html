<!DOCTYPE html>
<html>
<head>
    <meta http-equiv='cache-control' content='no-cache'> 
    <meta http-equiv='expires' content='0'> 
    <meta http-equiv='pragma' content='no-cache'>
    <title>Homework 2</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../prism.css"> 
</head>
<body>
    <!-- For this HW we are going to need AJAX -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>

    <h1>Homework 2</h1>
    <h2>Author: Pietro Colaguori 1936709</h2>
    <a href="../index.html">Home</a>
    <hr>
    <p>The request is as follows:</p><br>
    <pre class="question">Choose 3 variables from our surveys:
        - one Qualitative
        - one Quantitative discrete
        - one Quantitative continuous (use class intervals in this case, obviously)
        
        create the most efficient algorithms to compute the frequency (absolute/relative/percentage) distribution of:
        
        - the 3 variables
        - the joint distribution of 2 variables (use a general logic, where variables could be any number).
        
        Double check/compare the results using some DBMS functionalities you prefer (eg., access, oracle online, postgres, ...)</pre>

    <h3 class="red">Professional Life Survey - Analysis</h3>
    <!-- Qualitative: expected work sector, Quantitative: expected salary, Quantitative Continuous: height-->
    <p> Upload an XLSX file </p>
    <input type="file" id="fileInput" accept=".xlsx">
    <button id="upload" onclick="return analyze()">Upload</button>
    <div id="output"></div>
    
    <div id="results">
        <!-- Frequency distributions will be displayed here -->
    </div>

    <script type="text/javascript">
        function processExcel() {
            var file = document.getElementById("fileInput").files[0];
            var reader = new FileReader();
            reader.onload = function (e) {
                var data = e.target.result;
                var workbook = XLSX.read(data, { type: 'binary' });
                var sheetName = workbook.SheetNames[0];
                var xlData = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);

                // Extract the 3 variables from the Excel file
                var workSectors = [];
                var expectedSalary = [];
                var height = [];
                for (var i = 0; i < xlData.length; i++) {
                    workSectors.push(xlData[i]["Expected work sectors"]);
                    expectedSalary.push(xlData[i]["Expected salary"]);
                    function processData(file) {
                        var reader = new FileReader();
                        reader.onload = function(event) {
                            var data = event.target.result;
                            var workbook = XLSX.read(data, {type: "binary"});
                            var xlData = XLSX.utils.sheet_to_row_object_array(workbook.Sheets[workbook.SheetNames[0]]);
                            
                            // Extract the data for the 3 variables
                            var workSectors = [];
                            var expectedSalary = [];
                            var height = [];
                            for (var i = 0; i < xlData.length; i++) {
                                if (xlData[i]["work_sector"] !== "") {
                                    workSectors.push(xlData[i]["work_sector"]);
                                }
                                if (xlData[i]["expected_salary"] !== "") {
                                    expectedSalary.push(xlData[i]["expected_salary"]);
                                }
                                if (xlData[i]["height"] !== "") {
                                    height.push(xlData[i]["height"]);
                                }
                            }

                            // Compute the frequency distribution of the 3 variables
                            var workSectorsFreq = {};
                            for (var i = 0; i < workSectors.length; i++) {
                                if (workSectorsFreq[workSectors[i]] == undefined) {
                                    workSectorsFreq[workSectors[i]] = 1;
                                } else {
                                    workSectorsFreq[workSectors[i]]++;
                                }
                            }

                            var expectedSalaryFreq = {};
                            for (var i = 0; i < expectedSalary.length; i++) {
                                if (expectedSalaryFreq[expectedSalary[i]] == undefined) {
                                    expectedSalaryFreq[expectedSalary[i]] = 1;
                                } else {
                                    expectedSalaryFreq[expectedSalary[i]]++;
                                }
                            }

                            var heightFreq = {};
                            for (var i = 0; i < height.length; i++) {
                                if (heightFreq[height[i]] == undefined) {
                                    heightFreq[height[i]] = 1;
                                } else {
                                    heightFreq[height[i]]++;
                                }
                            }

                            // Compute the relative frequency distribution of the 3 variables
                            var workSectorsRelFreq = {};
                            for (var sector in workSectorsFreq) {
                                workSectorsRelFreq[sector] = workSectorsFreq[sector] / workSectors.filter(Boolean).length;
                            }

                            var expectedSalaryRelFreq = {};
                            for (var salary in expectedSalaryFreq) {
                                expectedSalaryRelFreq[salary] = expectedSalaryFreq[salary] / expectedSalary.filter(Boolean).length;
                            }

                            var heightRelFreq = {};
                            for (var h in heightFreq) {
                                heightRelFreq[h] = heightFreq[h] / height.filter(Boolean).length;
                            }

                            // Compute the percentage frequency distribution of the 3 variables
                            var workSectorsPercFreq = {};
                            for (var sector in workSectorsFreq) {
                                workSectorsPercFreq[sector] = workSectorsRelFreq[sector] * 100;
                            }

                            var expectedSalaryPercFreq = {};
                            for (var salary in expectedSalaryFreq) {
                                expectedSalaryPercFreq[salary] = expectedSalaryRelFreq[salary] * 100;
                            }

                            var heightPercFreq = {};
                            for (var h in heightFreq) {
                                heightPercFreq[h] = heightRelFreq[h] * 100;
                            }

                            // Display the frequency distributions on the page
                            displayResults(workSectorsFreq, expectedSalaryFreq, heightFreq, workSectorsRelFreq, expectedSalaryRelFreq, heightRelFreq, workSectorsPercFreq, expectedSalaryPercFreq, heightPercFreq);
                        };
                        reader.readAsBinaryString(file);
                    }

                    function displayResults(workSectorsFreq, expectedSalaryFreq, heightFreq, workSectorsRelFreq, expectedSalaryRelFreq, heightRelFreq, workSectorsPercFreq, expectedSalaryPercFreq, heightPercFreq) {
                        var resultsDiv = document.getElementById("results");
                        resultsDiv.innerHTML = "<h3>Frequency Distributions:</h3>";

                        // Display the frequency distribution for the "Expected work sectors" variable
                        resultsDiv.innerHTML += "<h4>Expected Work Sectors:</h4>";
                        resultsDiv.innerHTML += "<table>";
                        resultsDiv.innerHTML += "<tr><th>Work Sector</th><th>Frequency</th><th>Relative Frequency</th><th>Percentage Frequency</th></tr>";
                        for (var sector in workSectorsFreq) {
                            resultsDiv.innerHTML += "<tr><td>" + sector + "</td><td>" + workSectorsFreq[sector] + "</td><td>" + workSectorsRelFreq[sector].toFixed(2) + "</td><td>" + workSectorsPercFreq[sector].toFixed(2) + "%</td></tr>";
                        }
                        resultsDiv.innerHTML += "</table>";

                        // Display the frequency distribution for the "Expected salary" variable
                        resultsDiv.innerHTML += "<h4>Expected Salary:</h4>";
                        resultsDiv.innerHTML += "<table>";
                        resultsDiv.innerHTML += "<tr><th>Salary</th><th>Frequency</th><th>Relative Frequency</th><th>Percentage Frequency</th></tr>";
                        for (var salary in expectedSalaryFreq) {
                            resultsDiv.innerHTML += "<tr><td>" + salary + "</td><td>" + expectedSalaryFreq[salary] + "</td><td>" + expectedSalaryRelFreq[salary].toFixed(2) + "</td><td>" + expectedSalaryPercFreq[salary].toFixed(2) + "%</td></tr>";
                        }
                        resultsDiv.innerHTML += "</table>";

                        // Display the frequency distribution for the "Height" variable
                        resultsDiv.innerHTML += "<h4>Height:</h4>";
                        resultsDiv.innerHTML += "<table>";
                        resultsDiv.innerHTML += "<tr><th>Height</th><th>Frequency</th><th>Relative Frequency</th><th>Percentage Frequency</th></tr>";
                        for (var h in heightFreq) {
                            resultsDiv.innerHTML += "<tr><td>" + h + "</td><td>" + heightFreq[h] + "</td><td>" + heightRelFreq[h].toFixed(2) + "</td><td>" + heightPercFreq[h].toFixed(2) + "%</td></tr>";
                        }
                        resultsDiv.innerHTML += "</table>";
                    }
                }
            };
            reader.readAsBinaryString(file);
        }
    </script>
    
    <script src="../prism.js"></script>
</body>
</html>
